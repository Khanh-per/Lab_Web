---
title: 'LAB 7 [GUIDE]: SPRING BOOT & JPA CRUD'

---

---
title: LAB 7 SPRING BOOT & JPA CRUD

---

# LAB 7: SPRING BOOT & JPA CRUD
## Setup Guide & Sample Code

**Course:** Web Application Development  
**Duration:** 2.5 hours  
**Prerequisites:** Completed JSP/Servlet labs (Lab 1-6), Basic understanding of MVC

> **Note:** This lab introduces Spring Boot and Spring Data JPA. Read this BEFORE the lab session.

---

## ğŸ“‹ TABLE OF CONTENTS

1. [Why Spring Boot?](#1-why-spring-boot)
2. [Spring Boot Architecture Overview](#2-spring-boot-architecture-overview)
3. [Understanding Spring Data JPA](#3-understanding-spring-data-jpa)
4. [Project Setup](#4-project-setup)
5. [Sample Code - Spring Boot Implementation](#5-sample-code-spring-boot-implementation)
6. [Thymeleaf Introduction](#6-thymeleaf-introduction)
7. [Running the Demo](#7-running-the-demo)
8. [Comparison: Servlet vs Spring Boot](#8-comparison-servlet-vs-spring-boot)

---

## 1. WHY SPRING BOOT?

### Problems with Traditional Servlet/JSP Approach

**Example from Lab 6:**
```java
// StudentDAO.java - Manual JDBC
public class StudentDAO {
    private Connection getConnection() throws SQLException {
        return DriverManager.getConnection(DB_URL, DB_USER, DB_PASSWORD);
    }
    
    public List<Student> getAllStudents() {
        List<Student> students = new ArrayList<>();
        try (Connection conn = getConnection();
             PreparedStatement pstmt = conn.prepareStatement("SELECT * FROM students");
             ResultSet rs = pstmt.executeQuery()) {
            
            while (rs.next()) {
                Student student = new Student();
                student.setId(rs.getInt("id"));
                student.setName(rs.getString("full_name"));
                // ... manual mapping
                students.add(student);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return students;
    }
}
```

**Issues:**

1. âŒ **Boilerplate Code** - Repetitive JDBC operations
2. âŒ **Manual Configuration** - XML configuration files
3. âŒ **Complex Setup** - Server deployment, library management
4. âŒ **Manual Object Mapping** - ResultSet â†’ Object conversion
5. âŒ **No Dependency Management** - Manual JAR handling
6. âŒ **Hard to Test** - Tightly coupled components

### Benefits of Spring Boot

âœ… **Auto-Configuration** - Minimal setup, convention over configuration  
âœ… **Embedded Server** - No external Tomcat needed  
âœ… **Dependency Injection** - Loose coupling, testable code  
âœ… **Spring Data JPA** - No boilerplate JDBC code  
âœ… **Built-in Tools** - Development tools, actuator, metrics  
âœ… **Production-Ready** - Built for modern applications

---

## 2. SPRING BOOT ARCHITECTURE OVERVIEW

### Spring Boot Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PRESENTATION LAYER                â”‚
â”‚  (Controller - @Controller/@RestController) â”‚
â”‚  - Handles HTTP requests                    â”‚
â”‚  - Returns views or JSON                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SERVICE LAYER                    â”‚
â”‚           (@Service)                        â”‚
â”‚  - Business logic                           â”‚
â”‚  - Transaction management                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         REPOSITORY LAYER                    â”‚
â”‚  (@Repository - extends JpaRepository)      â”‚
â”‚  - Data access operations                   â”‚
â”‚  - Generated by Spring Data JPA             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           DATABASE                          â”‚
â”‚           (MySQL)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer Responsibilities

**ENTITY (Model):**
- Represents database tables
- Uses JPA annotations (@Entity, @Id, @Column)
- POJOs with getters/setters

**REPOSITORY:**
- Data access interface
- Extends JpaRepository<Entity, ID>
- Spring generates implementation automatically
- No need to write SQL for basic CRUD

**SERVICE:**
- Business logic layer
- Calls Repository methods
- Handles transactions
- Reusable across controllers

**CONTROLLER:**
- Handles HTTP requests
- Calls Service layer
- Returns views (Thymeleaf) or data (JSON)
- Uses @GetMapping, @PostMapping annotations

### Request Flow Example

**User clicks "View Products":**

```
1. Browser â†’ GET /products
2. ProductController receives request (@GetMapping)
3. Controller calls productService.getAllProducts()
4. Service calls productRepository.findAll()
5. JPA automatically queries database
6. Repository returns List<Product>
7. Controller adds data to Model
8. Returns view name "product-list"
9. Thymeleaf renders HTML
10. Response sent to browser
```

### Key Differences from Servlet

| Aspect | Servlet (Lab 6) | Spring Boot (Lab 7) |
|--------|----------------|---------------------|
| **Configuration** | XML + Annotations | Annotations only |
| **Database** | Manual JDBC | Spring Data JPA |
| **Server** | External Tomcat | Embedded |
| **Dependencies** | Manual JARs | Maven/Gradle |
| **Object Creation** | `new StudentDAO()` | `@Autowired` (DI) |
| **View Technology** | JSP + JSTL | Thymeleaf |

---

## 3. UNDERSTANDING SPRING DATA JPA

### What is JPA?

**JPA (Java Persistence API)** - Standard for ORM (Object-Relational Mapping)

**Benefits:**
- No SQL needed for basic operations
- Automatic object-to-table mapping
- Database-independent code
- Type-safe queries

### Entity Example

**Traditional JDBC (Lab 6):**
```java
public class Student {
    private int id;
    private String name;
    // getters/setters
}

// Manual SQL
String sql = "SELECT * FROM students WHERE id = ?";
```

**JPA Entity (Lab 7):**
```java
@Entity
@Table(name = "products")
public class Product {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "product_code", unique = true, nullable = false)
    private String productCode;
    
    @Column(nullable = false)
    private String name;
    
    // getters/setters
}

// No SQL needed
productRepository.findAll();        // SELECT *
productRepository.findById(1L);     // SELECT WHERE id = 1
productRepository.save(product);    // INSERT/UPDATE
productRepository.delete(product);  // DELETE
```

### JpaRepository Interface

```java
public interface ProductRepository extends JpaRepository<Product, Long> {
    // No implementation needed!
    // Spring Data JPA generates all methods automatically
    
    // Custom query methods (Spring generates SQL from method names)
    List<Product> findByName(String name);
    List<Product> findByCategory(String category);
    List<Product> findByPriceBetween(Double min, Double max);
}
```

**Built-in Methods (no code needed):**
- `findAll()` - Get all records
- `findById(id)` - Get by ID
- `save(entity)` - Insert or update
- `deleteById(id)` - Delete by ID
- `count()` - Count records
- `existsById(id)` - Check existence

---

## 4. PROJECT SETUP

### 4.1 Using Spring Initializr (Online)

**Step 1:** Go to https://start.spring.io/

**Step 2:** Configure project:
```
Project: Maven
Language: Java
Spring Boot: 3.3.x (latest stable)
Group: com.example
Artifact: product-management
Name: product-management
Package name: com.example.productmanagement
Packaging: Jar
Java: 17 or 21
```

**Step 3:** Add dependencies:
- Spring Web
- Spring Data JPA
- MySQL Driver
- Thymeleaf
- Lombok (optional)
- Spring Boot DevTools (optional)

**Step 4:** Click "Generate" â†’ Download ZIP â†’ Extract

---

### 4.2 Using VS Code

**Prerequisites:**
```
- Java JDK 17+
- VS Code
- Extension Pack for Java
- Spring Boot Extension Pack
- Maven
```

**Step 1: Install Extensions**
1. Open VS Code
2. Go to Extensions (Ctrl+Shift+X)
3. Search and install:
   - Extension Pack for Java
   - Spring Boot Extension Pack
   - MySQL (cweijan.vscode-mysql-client2)

**Step 2: Create Project**
1. Press `Ctrl+Shift+P`
2. Type: "Spring Initializr: Create a Maven Project"
3. Follow prompts:
   - Spring Boot version: 3.3.x
   - Language: Java
   - Group Id: com.example
   - Artifact Id: product-management
   - Packaging: Jar
   - Java version: 17

**Step 3: Add Dependencies**
Select:
- Spring Web
- Spring Data JPA
- MySQL Driver
- Thymeleaf

**Step 4: Open Project**
- Choose folder to save
- Open in current window or new window

---

### 4.3 Project Structure

```
product-management/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/
â”‚   â”‚   â”‚   â””â”€â”€ com/example/productmanagement/
â”‚   â”‚   â”‚       â”œâ”€â”€ ProductManagementApplication.java (Main)
â”‚   â”‚   â”‚       â”œâ”€â”€ entity/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ Product.java
â”‚   â”‚   â”‚       â”œâ”€â”€ repository/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ProductRepository.java
â”‚   â”‚   â”‚       â”œâ”€â”€ service/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ProductService.java
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ProductServiceImpl.java
â”‚   â”‚   â”‚       â””â”€â”€ controller/
â”‚   â”‚   â”‚           â””â”€â”€ ProductController.java
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.properties
â”‚   â”‚       â”œâ”€â”€ static/
â”‚   â”‚       â”‚   â””â”€â”€ css/
â”‚   â”‚       â””â”€â”€ templates/
â”‚   â”‚           â”œâ”€â”€ product-list.html
â”‚   â”‚           â””â”€â”€ product-form.html
â”‚   â”‚
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/
â”‚
â”œâ”€â”€ pom.xml (Maven dependencies)
â””â”€â”€ README.md
```

---

### 4.4 Database Setup

**Create Database:**
```sql
CREATE DATABASE product_management;
USE product_management;

CREATE TABLE products (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    product_code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    quantity INT DEFAULT 0,
    category VARCHAR(50),
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Sample data
INSERT INTO products (product_code, name, price, quantity, category, description) VALUES
('P001', 'Laptop Dell XPS 13', 1299.99, 10, 'Electronics', 'High-performance laptop'),
('P002', 'iPhone 15 Pro', 999.99, 25, 'Electronics', 'Latest iPhone model'),
('P003', 'Office Chair', 199.99, 50, 'Furniture', 'Ergonomic office chair');
```

---

### 4.5 Configuration

**File:** `src/main/resources/application.properties`

```properties
# Application Name
spring.application.name=product-management

# Server Port
server.port=8080

# Database Configuration
spring.datasource.url=jdbc:mysql://localhost:3306/product_management?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=your_password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# Thymeleaf Configuration
spring.thymeleaf.cache=false
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html

# Logging
logging.level.org.springframework=INFO
logging.level.com.example.productmanagement=DEBUG
```

**Configuration Explanations:**

**spring.jpa.hibernate.ddl-auto options:**
- `update` - Update schema (safe for development)
- `create` - Drop and recreate tables (data loss!)
- `create-drop` - Create on start, drop on shutdown
- `validate` - Only validate schema
- `none` - Do nothing

**Development vs Production:**
```properties
# Development
spring.jpa.show-sql=true
spring.thymeleaf.cache=false

# Production
spring.jpa.show-sql=false
spring.thymeleaf.cache=true
```

---

## 5. SAMPLE CODE - SPRING BOOT IMPLEMENTATION

### 5.1 ENTITY Layer

**File:** `src/main/java/com/example/productmanagement/entity/Product.java`

```java
package com.example.productmanagement.entity;

import jakarta.persistence.*;
import java.math.BigDecimal;
import java.time.LocalDateTime;

@Entity
@Table(name = "products")
public class Product {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(name = "product_code", unique = true, nullable = false, length = 20)
    private String productCode;
    
    @Column(nullable = false, length = 100)
    private String name;
    
    @Column(nullable = false, precision = 10, scale = 2)
    private BigDecimal price;
    
    @Column(nullable = false)
    private Integer quantity;
    
    @Column(length = 50)
    private String category;
    
    @Column(columnDefinition = "TEXT")
    private String description;
    
    @Column(name = "created_at", updatable = false)
    private LocalDateTime createdAt;
    
    // Constructors
    public Product() {
    }
    
    public Product(String productCode, String name, BigDecimal price, Integer quantity, String category, String description) {
        this.productCode = productCode;
        this.name = name;
        this.price = price;
        this.quantity = quantity;
        this.category = category;
        this.description = description;
    }
    
    // Lifecycle callback
    @PrePersist
    protected void onCreate() {
        this.createdAt = LocalDateTime.now();
    }
    
    // Getters and Setters
    public Long getId() {
        return id;
    }
    
    public void setId(Long id) {
        this.id = id;
    }
    
    public String getProductCode() {
        return productCode;
    }
    
    public void setProductCode(String productCode) {
        this.productCode = productCode;
    }
    
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
    
    public BigDecimal getPrice() {
        return price;
    }
    
    public void setPrice(BigDecimal price) {
        this.price = price;
    }
    
    public Integer getQuantity() {
        return quantity;
    }
    
    public void setQuantity(Integer quantity) {
        this.quantity = quantity;
    }
    
    public String getCategory() {
        return category;
    }
    
    public void setCategory(String category) {
        this.category = category;
    }
    
    public String getDescription() {
        return description;
    }
    
    public void setDescription(String description) {
        this.description = description;
    }
    
    public LocalDateTime getCreatedAt() {
        return createdAt;
    }
    
    public void setCreatedAt(LocalDateTime createdAt) {
        this.createdAt = createdAt;
    }
    
    @Override
    public String toString() {
        return "Product{" +
                "id=" + id +
                ", productCode='" + productCode + '\'' +
                ", name='" + name + '\'' +
                ", price=" + price +
                ", quantity=" + quantity +
                ", category='" + category + '\'' +
                '}';
    }
}
```

**JPA Annotations Explained:**

```java
@Entity                          // Marks class as JPA entity
@Table(name = "products")        // Maps to 'products' table

@Id                              // Primary key
@GeneratedValue(strategy = GenerationType.IDENTITY)  // Auto-increment

@Column(nullable = false)        // NOT NULL constraint
@Column(unique = true)           // UNIQUE constraint
@Column(length = 100)            // VARCHAR(100)
@Column(precision = 10, scale = 2)  // DECIMAL(10,2)
@Column(columnDefinition = "TEXT")  // TEXT type

@PrePersist                      // Runs before INSERT
@PreUpdate                       // Runs before UPDATE
```

---

### 5.2 REPOSITORY Layer

**File:** `src/main/java/com/example/productmanagement/repository/ProductRepository.java`

```java
package com.example.productmanagement.repository;

import com.example.productmanagement.entity.Product;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import java.math.BigDecimal;
import java.util.List;

@Repository
public interface ProductRepository extends JpaRepository<Product, Long> {
    
    // Spring Data JPA generates implementation automatically!
    
    // Custom query methods (derived from method names)
    List<Product> findByCategory(String category);
    
    List<Product> findByNameContaining(String keyword);
    
    List<Product> findByPriceBetween(BigDecimal minPrice, BigDecimal maxPrice);
    
    List<Product> findByCategoryOrderByPriceAsc(String category);
    
    boolean existsByProductCode(String productCode);
    
    // All basic CRUD methods inherited from JpaRepository:
    // - findAll()
    // - findById(Long id)
    // - save(Product product)
    // - deleteById(Long id)
    // - count()
    // - existsById(Long id)
}
```

**Method Naming Conventions:**

```java
// Pattern: findBy + PropertyName + Condition

findByName(String name)                    // WHERE name = ?
findByNameContaining(String keyword)       // WHERE name LIKE %keyword%
findByNameStartingWith(String prefix)      // WHERE name LIKE prefix%
findByNameEndingWith(String suffix)        // WHERE name LIKE %suffix

findByPriceGreaterThan(BigDecimal price)   // WHERE price > ?
findByPriceLessThan(BigDecimal price)      // WHERE price < ?
findByPriceBetween(Double min, Double max) // WHERE price BETWEEN min AND max

findByCategory(String category)            // WHERE category = ?
findByCategoryAndPrice(String cat, Double p) // WHERE category = ? AND price = ?
findByCategoryOrName(String cat, String n)   // WHERE category = ? OR name = ?

findByCategoryOrderByPriceAsc(String cat)  // ORDER BY price ASC
findByCategoryOrderByPriceDesc(String cat) // ORDER BY price DESC

existsByProductCode(String code)           // Check if exists
countByCategory(String category)           // COUNT WHERE category = ?
deleteByCategory(String category)          // DELETE WHERE category = ?
```

---

### 5.3 SERVICE Layer

**Interface:** `src/main/java/com/example/productmanagement/service/ProductService.java`

```java
package com.example.productmanagement.service;

import com.example.productmanagement.entity.Product;

import java.util.List;
import java.util.Optional;

public interface ProductService {
    
    List<Product> getAllProducts();
    
    Optional<Product> getProductById(Long id);
    
    Product saveProduct(Product product);
    
    void deleteProduct(Long id);
    
    List<Product> searchProducts(String keyword);
    
    List<Product> getProductsByCategory(String category);
}
```

**Implementation:** `src/main/java/com/example/productmanagement/service/ProductServiceImpl.java`

```java
package com.example.productmanagement.service;

import com.example.productmanagement.entity.Product;
import com.example.productmanagement.repository.ProductRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;
import java.util.Optional;

@Service
@Transactional
public class ProductServiceImpl implements ProductService {
    
    private final ProductRepository productRepository;
    
    @Autowired
    public ProductServiceImpl(ProductRepository productRepository) {
        this.productRepository = productRepository;
    }
    
    @Override
    public List<Product> getAllProducts() {
        return productRepository.findAll();
    }
    
    @Override
    public Optional<Product> getProductById(Long id) {
        return productRepository.findById(id);
    }
    
    @Override
    public Product saveProduct(Product product) {
        // Validation logic can go here
        return productRepository.save(product);
    }
    
    @Override
    public void deleteProduct(Long id) {
        productRepository.deleteById(id);
    }
    
    @Override
    public List<Product> searchProducts(String keyword) {
        return productRepository.findByNameContaining(keyword);
    }
    
    @Override
    public List<Product> getProductsByCategory(String category) {
        return productRepository.findByCategory(category);
    }
}
```

**Dependency Injection Explained:**

```java
// Constructor Injection (Recommended)
@Autowired
public ProductServiceImpl(ProductRepository productRepository) {
    this.productRepository = productRepository;
}

// Spring automatically creates ProductRepository implementation
// and injects it here. No 'new ProductRepository()' needed!
```

**@Transactional:**
- Automatically manages database transactions
- Commits on success, rolls back on exception
- Can be applied to class or method level

---

### 5.4 CONTROLLER Layer

**File:** `src/main/java/com/example/productmanagement/controller/ProductController.java`

```java
package com.example.productmanagement.controller;

import com.example.productmanagement.entity.Product;
import com.example.productmanagement.service.ProductService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import java.util.List;

@Controller
@RequestMapping("/products")
public class ProductController {
    
    private final ProductService productService;
    
    @Autowired
    public ProductController(ProductService productService) {
        this.productService = productService;
    }
    
    // List all products
    @GetMapping
    public String listProducts(Model model) {
        List<Product> products = productService.getAllProducts();
        model.addAttribute("products", products);
        return "product-list";  // Returns product-list.html
    }
    
    // Show form for new product
    @GetMapping("/new")
    public String showNewForm(Model model) {
        Product product = new Product();
        model.addAttribute("product", product);
        return "product-form";
    }
    
    // Show form for editing product
    @GetMapping("/edit/{id}")
    public String showEditForm(@PathVariable Long id, Model model, RedirectAttributes redirectAttributes) {
        return productService.getProductById(id)
                .map(product -> {
                    model.addAttribute("product", product);
                    return "product-form";
                })
                .orElseGet(() -> {
                    redirectAttributes.addFlashAttribute("error", "Product not found");
                    return "redirect:/products";
                });
    }
    
    // Save product (create or update)
    @PostMapping("/save")
    public String saveProduct(@ModelAttribute("product") Product product, RedirectAttributes redirectAttributes) {
        try {
            productService.saveProduct(product);
            redirectAttributes.addFlashAttribute("message", 
                    product.getId() == null ? "Product added successfully!" : "Product updated successfully!");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "Error saving product: " + e.getMessage());
        }
        return "redirect:/products";
    }
    
    // Delete product
    @GetMapping("/delete/{id}")
    public String deleteProduct(@PathVariable Long id, RedirectAttributes redirectAttributes) {
        try {
            productService.deleteProduct(id);
            redirectAttributes.addFlashAttribute("message", "Product deleted successfully!");
        } catch (Exception e) {
            redirectAttributes.addFlashAttribute("error", "Error deleting product: " + e.getMessage());
        }
        return "redirect:/products";
    }
    
    // Search products
    @GetMapping("/search")
    public String searchProducts(@RequestParam("keyword") String keyword, Model model) {
        List<Product> products = productService.searchProducts(keyword);
        model.addAttribute("products", products);
        model.addAttribute("keyword", keyword);
        return "product-list";
    }
}
```

**Controller Annotations Explained:**

```java
@Controller                      // Marks as Spring MVC controller
@RequestMapping("/products")     // Base URL for all methods

@GetMapping                      // GET /products
@GetMapping("/new")              // GET /products/new
@GetMapping("/edit/{id}")        // GET /products/edit/1

@PostMapping("/save")            // POST /products/save

@PathVariable Long id            // Extract from URL: /products/edit/{id}
@RequestParam String keyword     // Extract from query: ?keyword=laptop
@ModelAttribute Product product  // Bind form data to Product object

Model model                      // Add attributes for view
RedirectAttributes               // Add flash attributes for redirect
```

**Return Values:**
- `"product-list"` â†’ Renders `templates/product-list.html`
- `"redirect:/products"` â†’ Redirects to `/products` URL

---

## 6. THYMELEAF INTRODUCTION

### What is Thymeleaf?

**Thymeleaf** is a modern server-side template engine for Spring Boot applications.

**Why Thymeleaf over JSP?**

| Feature | JSP + JSTL | Thymeleaf |
|---------|------------|-----------|
| **HTML Valid** | No | Yes |
| **Designer Friendly** | No | Yes |
| **Spring Integration** | Manual | Native |
| **Natural Templates** | No | Yes |
| **Testing** | Requires server | Can test without server |

### Basic Syntax

**JSP (Lab 6):**
```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<c:forEach var="product" items="${products}">
    <td>${product.name}</td>
</c:forEach>
```

**Thymeleaf (Lab 7):**
```html
<tr th:each="product : ${products}">
    <td th:text="${product.name}">Product Name</td>
</tr>
```

### Core Attributes

```html
<!-- Text Content -->
<p th:text="${message}">Default message</p>
<p th:utext="${htmlContent}">Unescaped HTML</p>

<!-- Conditionals -->
<div th:if="${user != null}">Welcome back!</div>
<div th:unless="${user != null}">Please login</div>

<!-- Loops -->
<tr th:each="product : ${products}">
    <td th:text="${product.name}">Name</td>
</tr>

<!-- Links -->
<a th:href="@{/products/edit/{id}(id=${product.id})}">Edit</a>
<a th:href="@{/products(category=${cat})}">Filter</a>

<!-- Forms -->
<form th:action="@{/products/save}" th:object="${product}" method="post">
    <input type="text" th:field="*{name}" />
    <input type="number" th:field="*{price}" />
</form>

<!-- Attributes -->
<input type="text" th:value="${product.name}" />
<div th:class="${active} ? 'active' : 'inactive'">Status</div>
```

---

### 6.1 Product List View

**File:** `src/main/resources/templates/product-list.html`

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5568d3;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-sm {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        .search-form {
            display: flex;
            gap: 10px;
        }
        
        .search-form input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: #667eea;
            color: white;
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .actions-column {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ Product Management System</h1>
        
        <!-- Success Message -->
        <div th:if="${message}" class="alert alert-success">
            <span th:text="${message}"></span>
        </div>
        
        <!-- Error Message -->
        <div th:if="${error}" class="alert alert-error">
            <span th:text="${error}"></span>
        </div>
        
        <!-- Actions -->
        <div class="actions">
            <a th:href="@{/products/new}" class="btn btn-primary">â• Add New Product</a>
            
            <form th:action="@{/products/search}" method="get" class="search-form">
                <input type="text" name="keyword" th:value="${keyword}" placeholder="Search products..." />
                <button type="submit" class="btn btn-primary">ğŸ” Search</button>
            </form>
        </div>
        
        <!-- Products Table -->
        <div th:if="${products != null and !products.isEmpty()}">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Code</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Quantity</th>
                        <th>Category</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${products}">
                        <td th:text="${product.id}">1</td>
                        <td th:text="${product.productCode}">P001</td>
                        <td th:text="${product.name}">Product Name</td>
                        <td th:text="'$' + ${#numbers.formatDecimal(product.price, 1, 2)}">$99.99</td>
                        <td th:text="${product.quantity}">10</td>
                        <td th:text="${product.category}">Electronics</td>
                        <td>
                            <div class="actions-column">
                                <a th:href="@{/products/edit/{id}(id=${product.id})}" class="btn btn-success btn-sm">âœï¸ Edit</a>
                                <a th:href="@{/products/delete/{id}(id=${product.id})}" 
                                   class="btn btn-danger btn-sm"
                                   onclick="return confirm('Are you sure you want to delete this product?')">
                                    ğŸ—‘ï¸ Delete
                                </a>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- Empty State -->
        <div th:if="${products == null or products.isEmpty()}" class="empty-state">
            <p>No products found. Add your first product!</p>
        </div>
    </div>
</body>
</html>
```

---

### 6.2 Product Form View

**File:** `src/main/resources/templates/product-form.html`

```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #5568d3;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .button-group {
            margin-top: 30px;
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 th:text="${product.id != null} ? 'âœï¸ Edit Product' : 'â• Add New Product'">Product Form</h1>
        
        <form th:action="@{/products/save}" th:object="${product}" method="post">
            <!-- Hidden ID field for updates -->
            <input type="hidden" th:field="*{id}" />
            
            <div class="form-group">
                <label for="productCode">Product Code *</label>
                <input type="text" 
                       id="productCode" 
                       th:field="*{productCode}" 
                       placeholder="Enter product code (e.g., P001)"
                       required />
            </div>
            
            <div class="form-group">
                <label for="name">Product Name *</label>
                <input type="text" 
                       id="name" 
                       th:field="*{name}" 
                       placeholder="Enter product name"
                       required />
            </div>
            
            <div class="form-group">
                <label for="price">Price ($) *</label>
                <input type="number" 
                       id="price" 
                       th:field="*{price}" 
                       step="0.01" 
                       min="0"
                       placeholder="0.00"
                       required />
            </div>
            
            <div class="form-group">
                <label for="quantity">Quantity *</label>
                <input type="number" 
                       id="quantity" 
                       th:field="*{quantity}" 
                       min="0"
                       placeholder="0"
                       required />
            </div>
            
            <div class="form-group">
                <label for="category">Category *</label>
                <select id="category" th:field="*{category}" required>
                    <option value="">Select category</option>
                    <option value="Electronics">Electronics</option>
                    <option value="Furniture">Furniture</option>
                    <option value="Clothing">Clothing</option>
                    <option value="Books">Books</option>
                    <option value="Food">Food</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="description">Description</label>
                <textarea id="description" 
                          th:field="*{description}" 
                          placeholder="Enter product description (optional)"></textarea>
            </div>
            
            <div class="button-group">
                <button type="submit" class="btn btn-primary">ğŸ’¾ Save Product</button>
                <a th:href="@{/products}" class="btn btn-secondary">âŒ Cancel</a>
            </div>
        </form>
    </div>
</body>
</html>
```

**Thymeleaf Form Binding:**

```html
<!-- Form binding to product object -->
<form th:action="@{/products/save}" th:object="${product}" method="post">
    
    <!-- th:field automatically generates name, id, and value -->
    <input type="text" th:field="*{name}" />
    
    <!-- Equivalent to: -->
    <input type="text" id="name" name="name" value="${product.name}" />
</form>
```

---

## 7. RUNNING THE DEMO

### 7.1 Run from VS Code

**Method 1: Run Button**
1. Open `ProductManagementApplication.java`
2. Click "Run" button above `main()` method
3. Or press `F5`

**Method 2: Maven Command**
1. Open Terminal (Ctrl+`)
2. Run: `mvn spring-boot:run`

**Console Output:**
```
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.3.0)

2024-11-03 10:00:00.000  INFO 12345 --- [main] ProductManagementApplication : Starting ProductManagementApplication
2024-11-03 10:00:02.000  INFO 12345 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http)
2024-11-03 10:00:02.000  INFO 12345 --- [main] ProductManagementApplication : Started ProductManagementApplication in 2.5 seconds
```

---

### 7.2 Test the Application

**Open Browser:**
```
http://localhost:8080/products
```

**Test URLs:**

```
List all products:
http://localhost:8080/products

Add new product:
http://localhost:8080/products/new

Edit product (ID=1):
http://localhost:8080/products/edit/1

Search products:
http://localhost:8080/products/search?keyword=laptop

Delete product (ID=1):
http://localhost:8080/products/delete/1
```

---

### 7.3 Common Issues

| Issue | Solution |
|-------|----------|
| Port 8080 already in use | Change port in application.properties: `server.port=8081` |
| Cannot connect to MySQL | Verify MySQL is running, check credentials |
| Application won't start | Check Maven dependencies, run `mvn clean install` |
| Whitelabel Error Page | Check URL mapping and controller methods |
| Thymeleaf template not found | Verify template in `src/main/resources/templates/` |
| 404 on /products | Ensure `@RequestMapping("/products")` on controller |

---

## 8. COMPARISON: SERVLET VS SPRING BOOT

### Configuration

**Servlet (Lab 6):**
```java
// web.xml configuration needed
// Manual server setup
// Add libraries manually to WEB-INF/lib
```

**Spring Boot (Lab 7):**
```properties
# Just application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/product_management
spring.datasource.username=root
```

---

### Database Access

**Servlet JDBC (Lab 6):**
```java
public class StudentDAO {
    private Connection getConnection() throws SQLException {
        return DriverManager.getConnection(DB_URL, USER, PASS);
    }
    
    public List<Student> getAllStudents() {
        List<Student> students = new ArrayList<>();
        String sql = "SELECT * FROM students";
        
        try (Connection conn = getConnection();
             PreparedStatement pstmt = conn.prepareStatement(sql);
             ResultSet rs = pstmt.executeQuery()) {
            
            while (rs.next()) {
                Student s = new Student();
                s.setId(rs.getInt("id"));
                s.setName(rs.getString("full_name"));
                s.setEmail(rs.getString("email"));
                // Manual mapping...
                students.add(s);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        return students;
    }
}
```

**Spring Data JPA (Lab 7):**
```java
@Repository
public interface ProductRepository extends JpaRepository<Product, Long> {
    // That's it! No implementation needed.
    // Spring generates all CRUD methods automatically.
}

// Usage in Service:
List<Product> products = productRepository.findAll();  // Done!
```

---

### Controller

**Servlet (Lab 6):**
```java
@WebServlet("/student")
public class StudentController extends HttpServlet {
    
    private StudentDAO studentDAO;
    
    @Override
    public void init() {
        studentDAO = new StudentDAO();  // Manual instantiation
    }
    
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) 
            throws ServletException, IOException {
        
        String action = request.getParameter("action");
        
        if (action == null) action = "list";
        
        if (action.equals("list")) {
            List<Student> students = studentDAO.getAllStudents();
            request.setAttribute("students", students);
            RequestDispatcher dispatcher = request.getRequestDispatcher("/views/student-list.jsp");
            dispatcher.forward(request, response);
        }
    }
}
```

**Spring Boot (Lab 7):**
```java
@Controller
@RequestMapping("/products")
public class ProductController {
    
    @Autowired
    private ProductService productService;  // Auto-injected by Spring
    
    @GetMapping  // Cleaner than doGet()
    public String listProducts(Model model) {
        List<Product> products = productService.getAllProducts();
        model.addAttribute("products", products);
        return "product-list";  // Simpler return
    }
}
```

---

### View

**JSP + JSTL (Lab 6):**
```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<!DOCTYPE html>
<html>
<head><title>Students</title></head>
<body>
    <c:forEach var="student" items="${students}">
        <tr>
            <td>${student.fullName}</td>
            <td>
                <a href="student?action=edit&id=${student.id}">Edit</a>
            </td>
        </tr>
    </c:forEach>
</body>
</html>
```

**Thymeleaf (Lab 7):**
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head><title>Products</title></head>
<body>
    <tr th:each="product : ${products}">
        <td th:text="${product.name}">Product Name</td>
        <td>
            <a th:href="@{/products/edit/{id}(id=${product.id})}">Edit</a>
        </td>
    </tr>
</body>
</html>
```

---

### Summary Comparison

| Aspect | Servlet (Lab 6) | Spring Boot (Lab 7) |
|--------|----------------|---------------------|
| **Setup** | Complex, manual | Simple, auto-configured |
| **Database** | Manual JDBC | Spring Data JPA (no SQL) |
| **Boilerplate** | High | Minimal |
| **Testing** | Difficult | Easy |
| **Dependency Injection** | Manual `new` | Automatic `@Autowired` |
| **View** | JSP + JSTL | Thymeleaf |
| **Server** | External Tomcat | Embedded |
| **Configuration** | web.xml + code | application.properties |
| **Learning Curve** | Moderate | Higher initially, easier later |

---

## 9. BEST PRACTICES

### Entity Layer

âœ… **Use appropriate types:**
```java
Long id;                    // Use Long, not int
BigDecimal price;           // Use BigDecimal for money
LocalDateTime createdAt;    // Use java.time classes
```

âœ… **Add lifecycle callbacks:**
```java
@PrePersist
protected void onCreate() {
    this.createdAt = LocalDateTime.now();
}

@PreUpdate
protected void onUpdate() {
    this.updatedAt = LocalDateTime.now();
}
```

---

### Repository Layer

âœ… **Keep methods simple:**
```java
// Good
List<Product> findByCategory(String category);

// Bad - too complex, use @Query instead
List<Product> findByCategoryAndPriceBetweenAndQuantityGreaterThan(
    String category, BigDecimal min, BigDecimal max, Integer qty);
```

âœ… **Use @Query for complex queries:**
```java
@Query("SELECT p FROM Product p WHERE p.category = ?1 AND p.price BETWEEN ?2 AND ?3")
List<Product> findComplexQuery(String category, BigDecimal min, BigDecimal max);
```

---

### Service Layer

âœ… **Use interfaces:**
```java
public interface ProductService {
    List<Product> getAllProducts();
}

@Service
public class ProductServiceImpl implements ProductService {
    // Implementation
}
```

âœ… **Handle exceptions properly:**
```java
public Product saveProduct(Product product) {
    if (product.getPrice().compareTo(BigDecimal.ZERO) < 0) {
        throw new IllegalArgumentException("Price cannot be negative");
    }
    return productRepository.save(product);
}
```

---

### Controller Layer

âœ… **Use proper HTTP methods:**
```java
@GetMapping         // View/retrieve data
@PostMapping        // Create/submit data
@PutMapping         // Update data
@DeleteMapping      // Delete data
```

âœ… **Handle errors gracefully:**
```java
@GetMapping("/edit/{id}")
public String showEditForm(@PathVariable Long id, Model model) {
    return productService.getProductById(id)
            .map(product -> {
                model.addAttribute("product", product);
                return "product-form";
            })
            .orElse("redirect:/products?error=notfound");
}
```

---

## 10. SUMMARY

### What You Learned

âœ… **Spring Boot Basics** - Auto-configuration, embedded server  
âœ… **Spring Data JPA** - Repository pattern, no SQL needed  
âœ… **Dependency Injection** - @Autowired, loose coupling  
âœ… **MVC with Annotations** - @Controller, @GetMapping, @PostMapping  
âœ… **Thymeleaf** - Modern template engine  
âœ… **Project Structure** - Entity, Repository, Service, Controller layers

---

### Key Concepts

**Entity:**
- Represents database tables
- JPA annotations (@Entity, @Id, @Column)
- Auto-mapped to database

**Repository:**
- Data access interface
- Extends JpaRepository
- Spring generates implementation

**Service:**
- Business logic
- Calls Repository
- Transactional operations

**Controller:**
- Handles HTTP requests
- Calls Service
- Returns views

---

### Why Spring Boot Matters

1. **Industry Standard** - Used by most companies
2. **Productivity** - Less code, more features
3. **Modern** - Built for microservices, REST APIs
4. **Ecosystem** - Huge community, libraries
5. **Scalable** - Enterprise-ready

---

### Next Lab Preview

**Lab 8: REST API & DTO Pattern**
- Building RESTful APIs
- JSON responses
- DTO (Data Transfer Object) pattern
- Exception handling
- Testing APIs with Postman

---

**End of Setup Guide**

*Review this before Lab 7. Understand Spring Boot concepts thoroughly!*